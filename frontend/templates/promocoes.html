<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Promoções</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
  <header><h1>Promoções em Tempo Real</h1></header>
  <nav><a href="{{ url_for('index') }}">Início</a></nav>
  <section>
    <fieldset>
      <legend>Destinos:</legend>
      <label><input type="checkbox" name="destinos" value="rio"> Rio de Janeiro</label>
      <label><input type="checkbox" name="destinos" value="buzios"> Búzios</label>
      <label><input type="checkbox" name="destinos" value="ilhabela"> Ilhabela</label>
    </fieldset>
    <button id="registrar">Registrar Interesse</button>
    <button id="cancelar">Cancelar Interesse</button>
    <div id="notificacoes"></div>
  </section>
  <!-- ... código existente ... -->
<script>
    // Gerar ou obter client_id
    let client_id = localStorage.getItem('client_id');
    if (!client_id) {
        client_id = 'cli-' + Math.random().toString(36).substr(2, 9);
        localStorage.setItem('client_id', client_id);
    }
    
    document.getElementById("registrar").onclick = async () => {
        const res = await fetch('/api/registrar-interesse', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ client_id })
        });
        
        const eventSource = new EventSource(`/api/notificacoes/${client_id}`);
        eventSource.onmessage = (e) => {
            const msg = JSON.parse(e.data);
            const div = document.createElement("div");
            div.innerHTML = `<strong>${msg.promo.titulo}</strong><br>${msg.promo.descricao}`;
            document.getElementById("notificacoes").prepend(div);
        };
    };

    document.getElementById("cancelar").onclick = async () => {
        await fetch('/api/cancelar-interesse', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ client_id })
        });
    };
</script>
</body>
</html>
